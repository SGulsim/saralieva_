# Лабораторная работа 3: Реализация коллекций и интерфейсов

## Тема: реализация ĸоллеĸций и интерфейсов

## Цель

Познакомиться с интерфейсами коллекций в C# (.NET), реализовать простые коллекции и понять их контракт и функциональность.

## Реализованные коллекции

### 1. SimpleList<T>

**Расположение:** `lab03/Collections/SimpleList.cs`

**Реализуемые интерфейсы:**

- `IList<T>` — индексированный доступ, вставка, удаление по индексу
- `IList` — необобщенная версия интерфейса списка
- `IReadOnlyList<T>` — поддержка только чтения
- `ICollection<T>` — базовые операции: добавление, удаление, подсчёт элементов
- `IEnumerable<T>` — поддержка перебора элементов (foreach)

**Внутренняя структура:**

- Использует динамический массив (`T[]`) для хранения элементов
- Автоматическое расширение массива при необходимости (удвоение размера)
- Начальная ёмкость по умолчанию: 4 элемента
- Поддержка явного управления ёмкостью через свойство `Capacity`

**Реализованные методы и свойства:**

- `Count` — количество элементов
- `Capacity` — текущая ёмкость массива
- `this[int index]` — индексатор для доступа к элементам
- `Add(T item)` — добавление элемента в конец
- `Insert(int index, T item)` — вставка элемента по индексу
- `Remove(T item)` — удаление первого вхождения элемента
- `RemoveAt(int index)` — удаление элемента по индексу
- `Clear()` — очистка коллекции
- `Contains(T item)` — проверка наличия элемента
- `IndexOf(T item)` — поиск индекса элемента
- `CopyTo(T[] array, int arrayIndex)` — копирование в массив
- `AddRange(IEnumerable<T> items)` — добавление множества элементов
- `GetEnumerator()` — перечисление элементов

**Особенности реализации:**

- Версионирование коллекции (`_version`) для отслеживания изменений во время перечисления
- Собственный структурированный enumerator с проверкой изменений коллекции
- Валидация индексов и аргументов с выбрасыванием соответствующих исключений
- Поддержка необобщенного интерфейса `IList` для совместимости

**Сложность операций:**

- Доступ по индексу: O(1)
- Добавление в конец: O(1) амортизированно, O(n) при расширении
- Вставка: O(n)
- Удаление: O(n)
- Поиск: O(n)

### 2. SimpleDictionary<TKey, TValue>

**Расположение:** `lab03/Collections/SimpleDictionary.cs`

**Реализуемые интерфейсы:**

- `IDictionary<TKey, TValue>` — словарь, работа с ключами и значениями
- `IReadOnlyDictionary<TKey, TValue>` — словарь только для чтения
- `ICollection<KeyValuePair<TKey, TValue>>` — коллекция пар ключ-значение
- `IEnumerable<KeyValuePair<TKey, TValue>>` — перечисление пар

**Внутренняя структура:**

- Хеш-таблица с разрешением коллизий методом цепочек (chaining)
- Массив корзин (`_buckets`) для индексации записей
- Массив записей (`_entries`) для хранения пар ключ-значение
- Поддержка свободного списка (`_freeList`) для переиспользования удаленных записей
- Использование простых чисел для размера таблицы при ресайзе

**Реализованные методы и свойства:**

- `Count` — количество пар ключ-значение
- `this[TKey key]` — индексатор для доступа к значениям
- `Keys` — коллекция ключей (только для чтения)
- `Values` — коллекция значений (только для чтения)
- `Add(TKey key, TValue value)` — добавление пары
- `TryGetValue(TKey key, out TValue value)` — безопасное получение значения
- `ContainsKey(TKey key)` — проверка наличия ключа
- `Remove(TKey key)` — удаление по ключу
- `Clear()` — очистка словаря
- `Contains(KeyValuePair<TKey, TValue> item)` — проверка наличия пары
- `CopyTo(KeyValuePair<TKey, TValue>[] array, int arrayIndex)` — копирование в массив
- `GetEnumerator()` — перечисление пар

**Особенности реализации:**

- Поддержка кастомного компаратора через `IEqualityComparer<TKey>`
- Автоматическое расширение таблицы при достижении предела загрузки
- Эффективное переиспользование удаленных записей через свободный список
- Внутренние классы `KeyCollection` и `ValueCollection` для представления ключей и значений
- Версионирование для отслеживания изменений во время перечисления
- Собственный enumerator с пропуском удаленных записей

**Сложность операций:**

- Добавление: O(1) в среднем, O(n) в худшем случае
- Поиск: O(1) в среднем, O(n) в худшем случае
- Удаление: O(1) в среднем, O(n) в худшем случае

### 3. DoublyLinkedList<T>

**Расположение:** `lab03/Collections/DoublyLinkedList.cs`

**Реализуемые интерфейсы:**

- `IList<T>` — индексированный доступ, вставка, удаление по индексу
- `IList` — необобщенная версия интерфейса списка
- `IReadOnlyList<T>` — поддержка только чтения
- `ICollection<T>` — базовые операции
- `IEnumerable<T>` — поддержка перебора элементов

**Внутренняя структура:**

- Двунаправленный связный список с узлами, содержащими ссылки на предыдущий и следующий элементы
- Хранение указателей на голову (`_head`) и хвост (`_tail`) списка
- Внутренний класс `Node` для представления узлов

**Реализованные методы и свойства:**

- `Count` — количество элементов
- `this[int index]` — индексатор для доступа к элементам
- `Add(T item)` — добавление элемента в конец
- `Insert(int index, T item)` — вставка элемента по индексу
- `Remove(T item)` — удаление первого вхождения элемента
- `RemoveAt(int index)` — удаление элемента по индексу
- `Clear()` — очистка списка
- `Contains(T item)` — проверка наличия элемента
- `IndexOf(T item)` — поиск индекса элемента
- `CopyTo(T[] array, int arrayIndex)` — копирование в массив
- `GetEnumerator()` — перечисление элементов

**Особенности реализации:**

- Оптимизированный доступ по индексу: выбор направления обхода (от головы или от хвоста) в зависимости от позиции индекса
- Эффективная вставка и удаление за счет двунаправленных связей
- Версионирование коллекции для защиты от изменений во время перечисления
- Собственный enumerator с проверкой версии
- Поддержка необобщенного интерфейса `IList`

**Сложность операций:**

- Доступ по индексу: O(n), но оптимизирован (O(n/2) в среднем)
- Добавление в конец: O(1)
- Вставка: O(n)
- Удаление: O(n)
- Поиск: O(n)

## Тестирование

**Расположение:** `lab03/tests/`

Все коллекции покрыты автоматизированными unit-тестами с использованием фреймворка **NUnit 4.0.1**.

### SimpleListTests.cs

Тесты проверяют:

- Добавление элементов и увеличение счетчика
- Вставку элементов с сдвигом существующих
- Удаление элементов и корректность сдвига
- Работу перечислителя (enumerator)
- Установку значений через индексатор
- Проверку наличия элементов
- Обработку некорректных индексов

### SimpleDictionaryTests.cs

Тесты проверяют:

- Добавление и получение пар ключ-значение
- Обработку дублирующихся ключей
- Обновление значений через индексатор
- Удаление пар по ключу
- Безопасное получение значений через `TryGetValue`
- Перечисление всех пар

### DoublyLinkedListTests.cs

Тесты проверяют:

- Добавление элементов в конец списка
- Вставку элементов в начало и середину
- Удаление элементов по значению и индексу
- Чтение и запись через индексатор
- Проверку наличия элементов
- Корректность работы перечислителя
- Обработку некорректных индексов

**Характеристики тестов:**

- Детерминированность — одинаковые входные данные дают одинаковые результаты
- Воспроизводимость — тесты можно запускать многократно с предсказуемым результатом
- Покрытие основных операций всех коллекций

## Структура проекта

```
lab03/
├── Collections/
│   ├── SimpleList.cs          # Динамический массив
│   ├── SimpleDictionary.cs    # Хеш-таблица с цепочками
│   └── DoublyLinkedList.cs    # Двунаправленный связный список
├── tests/
│   ├── SimpleListTests.cs     # Тесты для SimpleList
│   ├── SimpleDictionaryTests.cs # Тесты для SimpleDictionary
│   └── DoublyLinkedListTests.cs # Тесты для DoublyLinkedList
├── Program.cs                 # Демонстрационная программа
└── lab03.csproj              # Файл проекта
```

## Технологии и зависимости

- **.NET 9.0** — целевая платформа
- **NUnit 4.0.1** — фреймворк для тестирования
- **NUnit3TestAdapter 4.5.0** — адаптер для запуска тестов
- **Microsoft.NET.Test.Sdk 17.11.1** — SDK для тестирования

## Демонстрация работы

В файле `Program.cs` представлена демонстрационная программа, показывающая использование всех трех коллекций:

1. **SimpleList<int>** — работа с динамическим массивом: добавление, вставка, удаление, перечисление
2. **DoublyLinkedList<string>** — работа со связным списком: добавление, вставка, удаление
3. **SimpleDictionary<string, int>** — работа со словарем: добавление, получение, удаление, перечисление пар

## Выводы

В ходе выполнения лабораторной работы были реализованы три полнофункциональные коллекции, демонстрирующие:

1. **Понимание интерфейсов коллекций** — корректная реализация всех требуемых интерфейсов с соблюдением их контрактов
2. **Внутреннее устройство структур данных** — реализация динамического массива, хеш-таблицы и связного списка "с нуля"
3. **Обработку граничных случаев** — валидация аргументов, обработка исключений, защита от изменений во время перечисления
4. **Практику тестирования** — написание детерминированных и воспроизводимых unit-тестов
